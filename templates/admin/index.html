<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>图书管理系统</title>
    <link rel="stylesheet" href="/static/css/admin/index.css">
</head>
<body>
<div class="container">
    <!-- 顶部导航栏 -->
    <header class="header">
        <div class="logo">
            <img src="/static/images/头像.png" style="border-radius: 50%;" alt="系统Logo">
            <span>久别</span>
        </div>
        <div class="user-info">
            <button class="logout-btn" onclick="window.location.href='/';">退出</button>
        </div>
    </header>


    <!-- 主内容区 -->
    <div class="main-content">
        <!-- 左侧菜单 -->
        <aside class="sidebar">
            
            <ul>
                <li class="active">
                    <a href="/AdminMain/">
                        <span>用户管理</span>
                    </a>
                </li>
                <li>
                    <a href="/test/">
                        <span>角色管理</span>
                    </a>
                </li>
                <li>
                    <a href="#">
                        <span>系统设置</span>
                    </a>
                </li>
            </ul>
        </aside>

        <!-- 右侧内容 -->
        <main class="content">
            <!-- 用户列表工具栏 -->
            <div class="toolbar">
                <div class="search-box">
                    <input type="text" placeholder="搜索用户">
                    <button class="search-btn">搜索</button>
                </div>
                <div class="action-buttons">
                    <button class="btn-export">拉入黑名单</button>
                    <button class="btn-delete">移出黑名单</button>
                </div>
            </div>

            <!-- 用户列表表格 -->
            <table class="user-table">
                <thead>
                <tr>
                    <th><input type="checkbox" class="select-all"></th>
                    <th>ID</th>
                    <th>用户名</th>
                    <th>密码</th>
                    <th>状态</th>
                    <th>操作</th>
                </tr>
                </thead>
                <tbody>
                <!-- 更多用户行 -->
                </tbody>
            </table>

            <!-- 分页 -->
            <div class="pagination">
                <button class="prev">上一页</button>
                <span class="page-info">第 1/10 页</span>
                <button class="next">下一页</button>
            </div>
        </main>
    </div>
</div>

<script>
     let currentPage = 1;
const totalPages = 10; // 假设你知道总页数

// 合并后的 fetchData 函数
const fetchData = async (page) => {
    try {
        const response = await fetch(`/Admin/userList/?page=${page}`);
        const data = await response.json();
        renderTable(data.users); // 假设返回的数据有 users 属性
        updatePagination(data.current_page, data.total_pages); // 假设返回的数据包含分页信息
    } catch (error) {
        console.error('获取用户数据失败:', error);
    }
};

// 渲染表格内容
const renderTable = (users) => {
    const tbody = document.querySelector('.user-table tbody');
    tbody.innerHTML = ''; // 清空表格内容
    users.forEach((user, index) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td><input type="checkbox"></td>
            <td>${user.uid}</td>
            <td>${user.username}</td>
            <td>${user.password}</td>
            <td>
                <span class="${user.is_blacklisted ? 'status-blacklisted' : 'status-active'}">
                    ${user.is_blacklisted ? '黑名单' : '正常'}
                </span>
            </td>
            <td>
                <button class="btn-edit">编辑</button>
                <button class="btn-delete">删除</button>
            </td>
        `;
        tbody.appendChild(tr);
    });
};

// 更新分页信息
const updatePagination = (currentPage, totalPages) => {
    const pageInfo = document.querySelector('.page-info');
    const prevButton = document.querySelector('.prev');
    const nextButton = document.querySelector('.next');

    // 更新页码显示
    pageInfo.textContent = `第 ${currentPage} / ${totalPages} 页`;

    // 根据当前页控制按钮显示
    prevButton.disabled = currentPage <= 1;
    nextButton.disabled = currentPage >= totalPages;
};

// 翻页功能
const changePage = (page) => {
    if (page < 1 || page > totalPages) return;
    currentPage = page;
    fetchData(currentPage);
};

// 页面加载完成后获取第一页数据
document.addEventListener('DOMContentLoaded', () => {
    fetchData(currentPage);

    // 上一页按钮
    document.querySelector('.prev').addEventListener('click', () => {
        changePage(currentPage - 1);
    });

    // 下一页按钮
    document.querySelector('.next').addEventListener('click', () => {
        changePage(currentPage + 1);
    });
});

</script>
</body>
</html>